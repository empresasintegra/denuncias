{% load static %}
<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="Consulta de Denuncias - Empresas Integra" />
        <meta name="author" content="Empresas Integra" />
        <title>Consulta Denuncias Integra</title>
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
        <link rel="stylesheet" href="{% static 'css/denuncia-styles.css' %}" />
        
        <style>
            .search-box {
                margin: 2rem auto;
                max-width: 500px;
                padding: 0 1rem;
            }
            
            .search-input {
                width: 100%;
                padding: 12px 20px;
                border: 2px solid #e9ecef;
                border-radius: 25px;
                font-size: 16px;
                outline: none;
                transition: border-color 0.3s;
            }
            
            .search-input:focus {
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }
            
            .table-container {
                margin: 2rem auto;
                max-width: 95%;
                background: white;
                border-radius: 15px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                height: 50vh;
                overflow: hidden;
            }
            
            .table-header {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 1.5rem;
                text-align: center;
            }
            
            .denuncias-table {
                width: 100%;
                border-collapse: collapse;
            }
            
            .denuncias-table th {
                background: #f8f9fa;
                padding: 12px 8px;
                text-align: left;
                font-weight: 600;
                color: #495057;
                border-bottom: 2px solid #dee2e6;
            }
            
            .denuncias-table td {
                padding: 12px 8px;
                border-bottom: 1px solid #e9ecef;
                vertical-align: top;
            }
            
            .denuncias-table tr:nth-child(even) {
                background-color: #f8f9fa;
            }
            
            .denuncias-table tr:hover {
                background-color: #e3f2fd;
            }
            
            .codigo-cell {
                font-family: 'Courier New', monospace;
                font-weight: bold;
                color: #667eea;
                min-width: 120px;
            }
            
            .estado-badge {
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 0.8rem;
                font-weight: 600;
                text-transform: uppercase;
            }
            
            .estado-pendiente {
                background-color: #fff3cd;
                color: #856404;
            }
            
            .estado-en_revision {
                background-color: #d1ecf1;
                color: #0c5460;
            }
            
            .estado-resuelto {
                background-color: #d4edda;
                color: #155724;
            }
            
            .descripcion-cell {
                max-width: 200px;
                word-wrap: break-word;
            }
            
            .no-results {
                text-align: center;
                padding: 2rem;
                color: #6c757d;
                font-style: italic;
            }
        </style>
    </head>
    <body id="page-top">

        <!-- Header -->
        {% include './headers/consulta_header.html' %}

        <!-- Buscador -->
        {% if total_denuncias != 1 %}
        <div class="search-box">
            <input type="text" 
                   id="searchInput" 
                   class="search-input" 
                   placeholder="🔍 Buscar en denuncias (código, usuario, categoría, descripción...)">
        </div>
        {% endif %}

        <!-- Tabla de denuncias -->
        {% if denuncias_data %}
        <div class="table-container">

            
            <table class="denuncias-table" id="denunciasTable">
                <thead>
                    <tr>
                        <th>Código</th>
                        <th>Caso</th>
                        <th>Relación Empresa</th>
                        <th>Tiempo</th>
                        <th>Estado</th>
                        <th>Fecha</th>
                    </tr>
                </thead>
                <tbody>
                    {% for denuncia in denuncias_data %}
                    <tr>
                        <td class="codigo-cell">{{ denuncia.codigo }}</td>
                        <td>{{ denuncia.item.enunciado }}</td>
                        <td>{{ denuncia.relacion_empresa.rol }}</td>
                        <td>{{ denuncia.tiempo.intervalo }}</td>
                        <td>
                            <span class="estado-badge estado-{{ denuncia.estado_actual|lower }}">
                                {{ denuncia.estado_actual }}
                            </span>
                        </td>
                        <td>{{ denuncia.fecha|date:"d/m/Y H:i" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <div class="no-results" id="noResults" style="display: none;">
                No se encontraron resultados para tu búsqueda
            </div>
        </div>
        {% endif %}

        <!-- Footer -->
        {% include './footer/footer.html' %}

        <script>
            // Buscador simple
            document.getElementById('searchInput').addEventListener('input', function() {
                const searchText = this.value.toLowerCase();
                const table = document.getElementById('denunciasTable');
                const rows = table.getElementsByTagName('tr');
                const noResults = document.getElementById('noResults');
                let visibleRows = 0;
                
                // Empezar desde 1 para saltar el header
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    const text = row.textContent.toLowerCase();
                    
                    if (text.includes(searchText)) {
                        row.style.display = '';
                        visibleRows++;
                    } else {
                        row.style.display = 'none';
                    }
                }
                
                // Mostrar/ocultar mensaje "no results"
                if (visibleRows === 0 && searchText !== '') {
                    noResults.style.display = 'block';
                } else {
                    noResults.style.display = 'none';
                }
            });
        </script>
    </body>
</html>